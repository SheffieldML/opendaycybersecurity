<html lang="en">
    
    <head>
        <meta charset="utf-8" />
        <title>[Activity 3] Email System</title>
         <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
            
        </script>
        
    </head>
    
    <body>
    <h1>[Activity 3] Email System</h1>
    <p id="receivedemails"></p>
<p>Internal Email system<br/>
<div class="conversation"></div>
<form id='email-form'>Subject: <input type='text' label='subject' id='subject' name='subject'><br />
Message<br/>
<textarea label='message' id='message' name='message' rows="10" cols="40">
</textarea>
<a href="#" id="send">send</a>
</form>
<script type="text/javascript"> 
            $('#send').on('click',function(){
                url = 'http://{{server}}/sendemail?subject='+encodeURIComponent($('input#subject').val())+"&message="+encodeURIComponent($('textarea#message').val());
                
                $.getJSON(url, function(data) {
                    alert('sent '+url);
                });
            alert("!");
            }) 

        
            setInterval(function () {
                url = "http://{{server}}/checkemail";
                $.ajax({
                    url: url,
                    success: function (data, status, jqXHR) { for (var i=0;i<JSON.parse(data).length;i++) {d=JSON.parse(data)[i]; console.log(d); $('p#receivedemails').html( $('p#receivedemails').html()+"<br/><b>"+d['sub']+"</b><br/>"+d['msg']); } } });
                },500);
        </script>

</body>
</html>
