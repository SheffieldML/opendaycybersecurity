<html lang="en">
    
    <head>
        <meta charset="utf-8" />
        <title>[Challenge 3] Email System</title>
         <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
            
        </script>
        
    </head>
    
    <body>
    <h1>[Challenge 3] Email System</h1>
    <p><b>Inbox [<span id="num">0</span> emails]</b></p>
    <p id="receivedemails"></p>
<p><b>Write Email:</b><br/>
<div class="conversation"></div>
To: Emma<br />
<form id='email-form'>Subject: <input type='text' label='subject' id='subject' name='subject'><br />
Message<br/>
<textarea label='message' id='message' name='message' rows="10" cols="40">
</textarea>
<a href="#" id="send">send</a> <span id="sentmsg">Sent!</span>
</form>
<script type="text/javascript"> 
$('span#sentmsg').hide();
num_emails = 0;
            $('#send').on('click',function(){
                url = 'http://{{server}}/sendemail?subject='+encodeURIComponent($('input#subject').val())+"&message="+encodeURIComponent($('textarea#message').val());
                $.getJSON(url, function(data) {
                    console.log("Sent Email");
                    $('input#subject').val("");
                    $('textarea#message').val("");
                    $('span#sentmsg').show();
                    $('span#sentmsg').fadeOut(3000);
                });
                
            }) 

        
            setInterval(function () {
                url = "http://{{server}}/checkemail";
                $.ajax({
                    url: url,
                    success: function (data, status, jqXHR) { 
                      for (var i=0;i<data.length;i++) {
                        d=data[i];
                        
                        console.log(d); 
                        $('p#receivedemails').html( $('p#receivedemails').html()+"<b>From: Emma<br/>Subject: "+d['sub']+"</b><br/>"+d['msg']+"<br/><br/>"); 
                        num_emails = num_emails + 1;
                        $('span#num').html(num_emails.toString());
                      } 
                    }
                  });
                },500);
        </script>

</body>
</html>
